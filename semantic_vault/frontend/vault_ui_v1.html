<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Semantic Vault</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; padding: 2em; }
    input, button, textarea { padding: 0.5em; margin: 0.5em 0; font-size: 1em; }
    .section { margin-bottom: 2em; border-bottom: 1px solid #444; padding-bottom: 1em; }
    .output { font-family: monospace; background: #222; padding: 1em; white-space: pre-wrap; }
    textarea { width: 100%; height: 5em; }
  </style>
</head>
<body>
  <h1>Semantic Vault</h1>

  <div class="section">
    <h2>ğŸ“ Store New Message</h2>
    <p>è«‹è¼¸å…¥ä»»æ„èªå¥æˆ– ZKProof ç­‰å­—ä¸²ï¼Œç³»çµ±æœƒè‡ªå‹•è½‰æ›ç‚º felt252 ä¸¦ç”Ÿæˆ CLI æŒ‡ä»¤ä¾›æ‰‹å‹•åŸ·è¡Œï¼ˆé™åˆ¶ç‚ºæœ€å¤š 31 bytesï¼Œéé•·å°‡å ±éŒ¯ï¼‰ï¼š</p>
    <input id="newMessage" placeholder="Enter text or number (è‡ªå‹•è½‰ç‚º felt252)" size="50" />
    <button onclick="storeMessage()">ç”¢ç”Ÿ CLI æŒ‡ä»¤</button>
    <div id="storeResult" class="output"></div>
  </div>

  <div class="section">
    <h2>ğŸ“Š Get Total Messages</h2>
    <p>é»æ“ŠæŒ‰éˆ•ç”ŸæˆæŸ¥è©¢ç›®å‰å·²å„²å­˜çš„è¨Šæ¯ç¸½æ•¸ CLI æŒ‡ä»¤ï¼š</p>
    <button onclick="generateTotalMessagesCommand()">ç”¢ç”Ÿ CLI æŒ‡ä»¤</button>
    <div id="totalResult" class="output"></div>
  </div>

  <div class="section">
    <h2>ğŸ” Get Message by ID</h2>
    <p>è¼¸å…¥è¨Šæ¯ç·¨è™Ÿï¼ˆè«‹æ³¨æ„æ˜¯å¾ 0 é–‹å§‹çš„æ•´æ•¸ï¼‰ç”¢ç”ŸæŸ¥è©¢ CLI æŒ‡ä»¤ï¼š</p>
    <input id="msgId" placeholder="Enter message ID (e.g., 0, 1, 2...)" />
    <button onclick="generateGetMessageCommand()">ç”¢ç”Ÿ CLI æŒ‡ä»¤</button>
    <div id="msgResult" class="output"></div>
  </div>

  <div class="section">
    <h2>ğŸ“¥ è§£ç¢¼ Felt252 çµæœ</h2>
    <p>å°‡å‰›å‰›æŸ¥è©¢æŒ‡ä»¤æ‰€è¿”å›çš„ç¬¬ä¸€æ®µæˆ–ç¬¬äºŒæ®µ felt252 å­—ä¸²è²¼å…¥æ­¤è™•è§£ç¢¼ç‚ºåŸå§‹èªå¥ï¼ˆè‹¥éåŸæœ¬ç”±æ–‡å­—è½‰æ›ï¼Œå¯èƒ½æœƒç„¡æ³•æ­£ç¢ºé¡¯ç¤ºï¼‰ï¼š</p>
    <input id="feltInput" placeholder="è²¼ä¸Š felt252 æ•¸å­— (ä¾‹å¦‚ 0x...) æˆ–åé€²ä½" size="80" />
    <button onclick="decodeInput()">è§£ç¢¼</button>
    <div id="decodeResult" class="output"></div>
  </div>

  <script>
    const CONTRACT_ADDRESS = "0x007877e3ab8f2f6744095cfeb3b17a1fbf4db1874fdf959ca95a856e5d568c7e";
    const PROVIDER_URL = "https://starknet-sepolia.public.blastapi.io/rpc/v0_8";

    function toFelt252(text) {
      const encoder = new TextEncoder();
      const bytes = encoder.encode(text);
      if (bytes.length > 31) throw new Error("å…§å®¹è¶…é 31 bytesï¼Œç„¡æ³•è½‰æ›ç‚ºåˆæ³• felt252");
      let hex = "0x" + Array.from(bytes).map(x => x.toString(16).padStart(2, "0")).join("");
      return BigInt(hex).toString();
    }

    function decodeFelt(felt) {
      try {
        let hex = felt.startsWith("0x") ? felt.slice(2) : BigInt(felt).toString(16);
        if (hex.length % 2 === 1) hex = "0" + hex;
        const bytes = new Uint8Array(hex.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
        return new TextDecoder().decode(bytes);
      } catch (e) {
        return "âŒ ç„¡æ³•è§£ç¢¼";
      }
    }

    function storeMessage() {
      const input = document.getElementById("newMessage").value.trim();
      if (!input) {
        document.getElementById("storeResult").innerText = "âŒ è«‹è¼¸å…¥èªå¥æˆ– felt252 æ•¸å­—ã€‚";
        return;
      }
      try {
        const felt = /^[0-9]+$/.test(input) ? input : toFelt252(input);
        const command = `starkli invoke --account ~/.starkli-wallets/deployer/account.json --keystore ~/.starkli-wallets/deployer/keystore.json --rpc ${PROVIDER_URL} ${CONTRACT_ADDRESS} store_message ${felt}`;
        document.getElementById("storeResult").innerText = `è«‹åœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥ä¸‹åˆ—æŒ‡ä»¤ï¼š\n\n${command}`;
      } catch (e) {
        document.getElementById("storeResult").innerText = `âŒ ç„¡æ³•è½‰æ›ï¼š${e.message}`;
      }
    }

    function generateTotalMessagesCommand() {
      const command = `starkli call --rpc ${PROVIDER_URL} ${CONTRACT_ADDRESS} total_messages`;
      document.getElementById("totalResult").innerText = `æŸ¥è©¢è¨Šæ¯ç¸½æ•¸ CLI æŒ‡ä»¤ï¼š\n\n${command}`;
    }

    function generateGetMessageCommand() {
      const id = document.getElementById("msgId").value.trim();
      if (!/^[0-9]+$/.test(id)) {
        document.getElementById("msgResult").innerText = "âŒ è«‹è¼¸å…¥æ­£æ•´æ•¸ä½œç‚ºè¨Šæ¯ IDã€‚";
        return;
      }
      const command = `starkli call --rpc ${PROVIDER_URL} ${CONTRACT_ADDRESS} get_message ${id}`;
      document.getElementById("msgResult").innerText = `æŸ¥è©¢è¨Šæ¯ CLI æŒ‡ä»¤ï¼š\n\n${command}\n\nè«‹åŸ·è¡ŒæŒ‡ä»¤å¾Œï¼Œå°‡çµæœè²¼å…¥ä¸‹æ–¹æ¬„ä½é€²è¡Œè§£ç¢¼ã€‚`;
    }

    function decodeInput() {
      const felt = document.getElementById("feltInput").value.trim();
      if (!felt) {
        document.getElementById("decodeResult").innerText = "âŒ è«‹è²¼å…¥è¦è§£ç¢¼çš„ felt252ã€‚";
        return;
      }
      const result = decodeFelt(felt);
      document.getElementById("decodeResult").innerText = `è§£ç¢¼çµæœï¼š\n${result}`;
    }
  </script>
</body>
</html>
